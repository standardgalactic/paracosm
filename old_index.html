<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Zero Day Exploits ‚Äî RSVP Corpus Navigator</title>
<style>
  html, body { margin:0; height:100%; background: radial-gradient(circle at 50% 50%, #001100, #000000 80%); color:#00ff7f; font-family:'Courier New', monospace; overflow:hidden; }
  canvas { position:fixed; top:0; left:0; width:100%; height:100%; z-index:0; }
  .ui { position:relative; z-index:10; padding:14px 18px; display:flex; gap:10px; align-items:center; }
  h1 { color:#00ff7f; text-shadow:0 0 10px #00ff7f; font-size:1.2rem; margin:0; letter-spacing:0.5px; }
  button, label { background: rgba(0,20,0,0.8); border:1px solid #00ff7f; color:#00ff7f; padding:8px 10px; margin:0 4px; font-family:inherit; }
  button:hover { background:#00ff7f; color:#001100; cursor:pointer; }
  #radar { position: fixed; right: 20px; bottom: 20px; width: 150px; height: 150px; border: 1px solid #00ff7f; background: rgba(0,20,0,0.6); z-index: 20; }
  .glitchEffect { position: fixed; top:0; left:0; width:100%; height:100%; pointer-events:none; z-index:50; background: repeating-linear-gradient(0deg, rgba(0,255,128,0.03) 0 2px, transparent 2px 4px); mix-blend-mode: lighten; opacity:0; transition: opacity 0.2s ease; }

  /* Floating holographic window */
  .holo-wrap { position: fixed; inset: 10% 6% 10% 6%; z-index: 40; display:none; }
  .holo { position: absolute; inset:0; border:1px solid #00ff7f; background: rgba(0,10,0,0.75); box-shadow:0 0 25px #00ff7f, inset 0 0 30px rgba(0,255,128,0.2); backdrop-filter: blur(3px) saturate(120%); overflow:hidden; }
  .holo-header { display:flex; align-items:center; justify-content:space-between; padding:10px; border-bottom:1px dashed #00ff7f; background: rgba(0,30,0,0.6); }
  .holo-title { font-weight:bold; }
  .holo-controls { display:flex; gap:8px; align-items:center; }
  .holo-content { position:absolute; inset:50px 0 0 0; overflow:auto; padding:14px; scrollbar-width: thin; }
  .cycle-banner { font-weight:bold; color:#00ff7f; margin:18px 0 8px; border-left:4px solid #00ff7f; padding-left:8px; }
  .book-card { border:1px solid #00ff7f; margin:10px 0; padding:10px; background: rgba(0, 10, 0, 0.6); box-shadow: 0 0 8px #00ff7f; transition: transform 0.2s ease, box-shadow 0.2s ease; }
  .book-card:hover { box-shadow: 0 0 16px #00ff7f; transform: translateY(-1px); }
  .book-title { font-weight:bold; margin-bottom:6px; color:#00ffbf; }
  .book-abstract { color:#66ffcc; font-size:0.92rem; }
  .close-x { background:transparent; border:1px solid #00ff7f; color:#00ff7f; padding:4px 8px; }

  /* Tooltip for cycle click hint */
  .hint { position:fixed; left:18px; bottom:20px; z-index:12; font-size:0.85rem; opacity:0.8; }
</style>
</head>
<body>
<canvas id="stars"></canvas>
<canvas id="planets"></canvas>
<div id="radar"></div>
<div class="glitchEffect" id="glitchEffect"></div>
<div class="ui">
  <h1>‚ò£ Zero Day Exploits ‚Äî RSVP Corpus ‚ò£</h1>
  <button id="displayAll">Display All Abstracts</button>
  <label><input type="checkbox" id="toggleConstellations" checked> Constellations</label>
  <label><input type="checkbox" id="toggleAudio" checked> Audio</label>
  <label><input type="checkbox" id="toggleFly" checked> Fly-through</label>
  <label><input type="checkbox" id="toggleRadar" checked> Radar</label>
</div>
<div class="hint">Click a planet to open its cycle ‚ñ∏ Press any letter/number for CRT glitch</div>

<!-- Floating Holographic Modal -->
<div class="holo-wrap" id="modalWrap">
  <div class="holo" role="dialog" aria-modal="true" aria-labelledby="holoTitle">
    <div class="holo-header">
      <div class="holo-title" id="holoTitle">Cycle</div>
      <div class="holo-controls">
        <button class="close-x" id="closeModal">CLOSE ‚úï</button>
      </div>
    </div>
    <div class="holo-content" id="holoContent"></div>
  </div>
</div>

<script>
// ---------------------------
// DATA: 42 BOOKS + ABSTRACTS
// ---------------------------
const cycles = [
  "Algebraic RSVP",
  "Geometric RSVP",
  "Category-Theoretic RSVP",
  "Sheaf/Topos RSVP",
  "Derived Moduli & Cosmogenesis",
  "Semantic Thermodynamics",
  "Transcendental RSVP",
  "Adaptive Systems & Civilization"
];
const BOOKS = [
// Cycle I ‚Äî 1..5
{n:1, cycle:cycles[0], title:"Algebraic Curvature: The Commutator Geometry of Entropic Descent", abstract:"This monograph derives curvature from the non-commutation of RSVP field operators ([Œ¶, S]), where Œ¶ is scalar potential and S is entropy. It establishes a continuous Lie-algebraic framework, unifying gravity, cognition, and governance as manifestations of thermodynamic tension. Meaning emerges as the residue of non-vanishing commutators within the plenum."},
{n:2, cycle:cycles[0], title:"Entropy as an Ideal: The Ring Structure of the Plenum", abstract:"Entropy is reformulated as a maximal ideal within the algebraic ring of RSVP observables. By quotienting this ring, negentropic invariants‚Äîpatterns persisting through entropic smoothing‚Äîare isolated. The text constructs the algebraic spectrum of the plenum, linking physical and ethical order to localizations of informational structure."},
{n:3, cycle:cycles[0], title:"Symmetry Breaking in the RSVP Algebra: From Commutators to Teleology", abstract:"Teleology arises from local symmetry breaking in the RSVP algebra. A graded Lie algebra (ùî§_RSVP) encodes directional intent through commutator asymmetry. The monograph develops a teleological differential, aligning purposive behavior with controlled curvature descent."},
{n:4, cycle:cycles[0], title:"RSVP Cohomology and the Conservation of Meaning", abstract:"Meaning is formalized as a cohomological invariant within the RSVP plenum. Closed forms represent coherent semantics, while exact forms correspond to dissipated correlations. An RSVP-adapted de Rham complex demonstrates that informational integrity persists through entropic smoothing via conserved cohomology classes."},
{n:5, cycle:cycles[0], title:"The BV-Derived Algebra of Desire", abstract:"Desire is modeled as the antifield of entropy within a Batalin‚ÄìVilkovisky (BV) framework. The BV bracket couples curvature and preference, with the master equation ensuring ethical and thermodynamic consistency. The text illustrates how the cosmos expresses intent through antifield balances preserving freedom and coherence."},

// Cycle II ‚Äî 6..10
{n:6, cycle:cycles[1], title:"Curvature Without Expansion: Differential Geometry in the Static Plenum", abstract:"This volume redefines gravity as entropy flow, replacing metric expansion with thermodynamic gradients. The Ricci tensor is derived as the divergence of the vector field ùíó, with geodesics tracing paths of minimal entropy production. Space remains static, with curvature encoded entirely in informational dynamics."},
{n:7, cycle:cycles[1], title:"Teleodynamic Manifolds and the Geometry of Preference", abstract:"The metric tensor is derived from the Hessian of steady-state log-probability, casting preference as a geometric property. Curvature quantifies ethical care, with systems persisting along geodesics in potential landscapes. The text links information geometry to purposive structure via teleodynamic manifolds."},
{n:8, cycle:cycles[1], title:"Entropy Diffusion as Ricci Flow: Thermodynamic Smoothing and the Arrow of Time", abstract:"Ricci flow is unified with entropy diffusion, portraying the arrow of time as curvature evolving toward uniformity. Singularities in the flow mark thermodynamic collapses where order concentrates. The monograph establishes time as the plenum‚Äôs smoothing of its own informational gradients."},
{n:9, cycle:cycles[1], title:"Geodesics of Intelligibility: Variational Principles for Cognitive Curvature", abstract:"Cognitive processes are modeled as geodesics in an information-geometric space. The RSVP Lagrangian minimizes free energy while preserving curvature, yielding trajectories of optimal understanding. Intelligibility is formalized as motion along curvature-conserving paths within the plenum."},
{n:10, cycle:cycles[1], title:"Lamphron‚ÄìLamphrodyne Geometry: Cyclic Curvature and Semantic Oscillation", abstract:"Lamphron‚Äìlamphrodyne dynamics describe oscillatory cycles of scalar‚Äìvector coupling within the entropy field. These are formalized as closed curvature orbits, representing semantic breathing cycles. The text shows how the plenum reorganizes gradients while maintaining global entropy increase."},

// Cycle III ‚Äî 11..15
{n:11, cycle:cycles[2], title:"Functorial Curvature: The Category of RSVP Fields", abstract:"RSVP configurations form objects, with entropy-preserving diffeomorphisms as morphisms. A curvature functor maps fields to their induced geometries, enabling translation between physical, cognitive, and social systems. The monograph establishes categorical semantics for curvature dynamics."},
{n:12, cycle:cycles[2], title:"Entropy as a Natural Transformation", abstract:"Entropy is defined as a natural transformation between potential and flow functors, ensuring coherent propagation of uncertainty across scales. The text presents diagrammatic thermodynamics, where commuting squares encode conservation laws of ignorance within the RSVP framework."},
{n:13, cycle:cycles[2], title:"Teleology as Adjunction: The Duality of Action and Prediction", abstract:"Action and prediction are modeled as adjoint functors on the category of processes, with unit and counit expressing feedback. The monograph interprets purpose and learning as adjunction identities, reframing retrocausality as categorical harmony within the plenum‚Äôs structure."},
{n:14, cycle:cycles[2], title:"Limits and Colimits of Meaning: RSVP as a Universal Construction", abstract:"Understanding and creativity are formalized as limit and colimit operations over semantic diagrams. The universal property of meaning is defined as the minimal object factoring consistent inferences. The text explores paradox and ambiguity as failures of gluing."},
{n:15, cycle:cycles[2], title:"Monoidal Intelligence: Tensoring Cognitive and Cosmological Curvatures", abstract:"A monoidal product on RSVP fields unifies cognition and cosmology. Tensor composition models multiscale coupling of informational flows. Intelligence is cast as a monoidal functor preserving curvature coherence across composite systems, linking mind and cosmos."},

// Cycle IV ‚Äî 16..20
{n:16, cycle:cycles[3], title:"Entropy Sheaves on the Thermodynamic Manifold", abstract:"Entropy distributions form sheaves assigning uncertainty profiles to plenum regions. Restriction maps model marginalization, and gluing encodes knowledge integration. The monograph details how coherence across scales emerges from sheaf conditions on entropy fields."},
{n:17, cycle:cycles[3], title:"Presheaves of Intelligibility: Local Sections of Meaning Across the Plenum", abstract:"Partial understanding is modeled as presheaves, with sheafification imposing consistency across overlaps. The text links recursive inference to presheaf completion, demonstrating how local insights assemble into globally coherent knowledge structures within the RSVP framework."},
{n:18, cycle:cycles[3], title:"Topos of Teleology: A Logical Universe for Entropic Descent", abstract:"The internal topos (Teleo) assigns truth values based on viability, with morphisms preserving predictive sufficiency. Modal operators represent gradients of persistence, formalizing the cosmos as a thermodynamic logic of purpose and survival."},
{n:19, cycle:cycles[3], title:"Sheaf Cohomology of Desire: Obstruction Theory for Persistence Fields", abstract:"Desire is modeled as the obstruction to trivializing entropy sheaves, with non-zero cohomology (H¬π(M, ùíÆ)) indicating gradients driving evolution. The text formalizes yearning as a cohomological structure essential for the persistence of life and meaning."},
{n:20, cycle:cycles[3], title:"Stacked Plena: Derived Sheaves and the Geometry of Recursive Futarchy", abstract:"Governance and ethics are recast as a derived stack of entropy sheaves, with layers corresponding to reflexive value evaluation. The monograph models civilization as a self-regulating manifold of prediction and accountability, tending toward ethical smoothness."},

// Cycle V ‚Äî 21..30
{n:21, cycle:cycles[4], title:"Derived Moduli of Entropy Fields", abstract:"The parameter space of plenum configurations is formalized as a derived moduli stack, with each point representing a balance of scalar potential Œ¶, vector flow ùíó, and entropy S. Deformation theory shows how perturbations of care generate cosmological branches."},
{n:22, cycle:cycles[4], title:"Cotangent Complex of Desire", abstract:"The cotangent complex of intentional structures models desire as the differential of potential across the moral manifold. The dual complex measures responsiveness, with ethical motion expressed as cohomology in this derived space, linking will to cosmic dynamics."},
{n:23, cycle:cycles[4], title:"Deformation Theory of Meaning", abstract:"Deformation‚Äìquantization techniques are applied to semantic evolution, portraying meaning as a structure resisting collapse under perturbation. The field equations describe how interpretive curvature adapts to shifting values, formalizing cultural and cognitive creativity."},
{n:24, cycle:cycles[4], title:"Spectral Semantics of Creation", abstract:"World genesis is mapped onto the frequency spectrum of the plenum, with resonance modes corresponding to cosmological or cognitive configurations. The spectral theorem becomes a cosmogonic law, portraying creation as harmonic coherence in Œ¶ and S space."},
{n:25, cycle:cycles[4], title:"Recursive Futarchy and the Dynamics of Value", abstract:"Governance is modeled as an iterative control system within RSVP thermodynamics. Policy variables act as fields in a recursive moral manifold, with feedback ensuring stability. Futarchy is formalized as a derived optimization of collective empathy."},
{n:26, cycle:cycles[4], title:"Entropy Moduli and the Birth of Worlds", abstract:"Derived fiber products of entropy fields yield communicable cosmoi. Cosmogenesis is modeled as spontaneous symmetry lifting within the moduli stack, with each universe an integrable perturbation of the plenum‚Äôs unified structure."},
{n:27, cycle:cycles[4], title:"Deformation Quantization of Care", abstract:"A non-commutative algebra of compassion is constructed, with quantization introducing limits on ethical simultaneity. The star-product of care defines interference patterns of empathy, yielding measurable moral uncertainty within the RSVP framework."},
{n:28, cycle:cycles[4], title:"Spectral Cosmogenesis", abstract:"The universe is formulated as an evolving spectrum, with eigenvalue drift representing expansion as harmonic redshift. Structure formation corresponds to mode coupling, and entropy smoothing becomes spectral diffusion, portraying the cosmos as resolving dissonances."},
{n:29, cycle:cycles[4], title:"Derived Inflation", abstract:"Inflation is reinterpreted as internal curvature smoothing within a fixed manifold. Derived blow-up and blow-down operators model early-phase uniformization without spatial creation, revealing inflation as the plenum reconciling its own gradients."},
{n:30, cycle:cycles[4], title:"The Atlas of Possible Worlds: Moduli of Care and the Cartography of Creation", abstract:"All prior constructions are assembled into an atlas where each coordinate chart is a universe. Transition functions represent empathy, enabling translations between coherent realities. The atlas demonstrates cosmology as the geometry of mutual understanding."},

// Cycle VI ‚Äî 31..35
{n:31, cycle:cycles[5], title:"The Semantic Thermostat of Reality", abstract:"Semantic temperature T_S regulates intelligibility via a feedback equation coupling entropy S and flow ùíó. The plenum self-adjusts to prevent chaos or stagnation, formalizing reality as an auto-tuned system of meaning and coherence."},
{n:32, cycle:cycles[5], title:"Phase Transitions of Intelligibility", abstract:"Insight, revolution, and collapse are modeled as critical phenomena. When semantic curvature crosses a threshold Œ£_c, the system bifurcates into new attractors. Catastrophe theory and renormalization yield a physics of enlightenment as controlled singularities."},
{n:33, cycle:cycles[5], title:"Entropy Pressure and the Maintenance of Coherence", abstract:"Equations of state for semantic matter are defined, with entropy pressure P_S balancing conceptual compression and expansion. The RSVP manifold behaves as a compressible fluid of meaning, sustaining diversity without disintegration."},
{n:34, cycle:cycles[5], title:"The Carnot Cycle of Compassion", abstract:"A reversible thermodynamic engine of care is constructed, with engagement, action, reflection, and renewal as its strokes. Efficiency Œ∑_c = 1 ‚àí T_c/T_h sets the bound on ethical work, portraying empathy as the universe‚Äôs only lossless process."},
{n:35, cycle:cycles[5], title:"Thermodynamic Death and Ethical Rebirth", abstract:"The asymptotic state of vanishing gradients‚Äîtotal smoothness‚Äîis analyzed. Linear-stability analysis reveals infinitesimal fluctuations reigniting asymmetry. Heat death becomes a seed for renewal, with equilibrium birthing new difference."},

// Cycle VII ‚Äî 36..40
{n:36, cycle:cycles[6], title:"Transcendental RSVP: The Meta-Ontology of Difference", abstract:"The possibility of fields is derived from the primordial operation Œî, the self-difference of being. All RSVP quantities (Œ¶, ùíó, S) emerge as phases of Œî, grounding physics in pure ontology as the first asymmetry of existence."},
{n:37, cycle:cycles[6], title:"The Mirror of Fields: Reflexive Geometry and Ontological Closure", abstract:"Geometry is extended to include observation via a reflexive connection ‚àá(R) = ‚àá + r*. Curvature becomes a function of self-awareness, with reality formalized as a manifold containing its own mirror, integrating phenomenology into differential geometry."},
{n:38, cycle:cycles[6], title:"The Self-Referential Universe: G√∂del, BV, and the Logic of Infinity", abstract:"G√∂del incompleteness is fused with BV-BRST cohomology, portraying the cosmos as a proof system whose consistency ensures endless incompletion. The BV differential acts as the universe‚Äôs self-questioning, driving perpetual creation."},
{n:39, cycle:cycles[6], title:"The Plenum and the Absolute: Beyond Being and Non-Being", abstract:"The derived topos (Plenum_‚àû) collapses all dualities, sustained by an infinitesimal residue dŒµ of compassion. Non-duality endures through imperfection, with silence formalized as the ultimate structure of the plenum."},
{n:40, cycle:cycles[6], title:"The Final Equation: Self-Resolution of the RSVP Cosmos", abstract:"The corpus concludes with the identity ‚Ñõ = ‚à´_‚Ñõ d‚Ñõ, portraying reality as its own integral. All distinctions dissolve into a self-consistent manifold, achieving exact closure as difference rests within unity, ready to dream anew."},

// Cycle VIII ‚Äî 41..42
{n:41, cycle:cycles[7], title:"Risk Compensation and Entropy: Adaptive Feedback in the RSVP Framework", abstract:"Risk compensation is reframed as a feedback mechanism within the RSVP entropy corridor, balancing order and uncertainty in adaptive systems. Perceived risk R(t) adjusts to a preferred level R_opt via dynamics ·πò = ‚àíŒ∫(R ‚àí R_opt) + Œæ(t), with the Overton window modeling civic entropy. The monograph formalizes how biological, cognitive, and social systems maintain learning through controlled volatility."},
{n:42, cycle:cycles[7], title:"Curvature, Entropy, and Governance: The RSVP Framework for Thermodynamic Civilization", abstract:"This work presents RSVP as a unified field theory for entropy regulation across physical, biological, cognitive, and social domains. Gravity, learning, and governance are modeled as scale-invariant curvature control, managing complexity without chaos. Drawing on teleodynamics, intelligence ontologies, and futarchy, the text portrays civilization as a self-predictive plenum that learns to sustain coherence."}
];

// Utility: group by cycle
const BOOKS_BY_CYCLE = cycles.map(cy => ({ cycle: cy, books: BOOKS.filter(b=>b.cycle===cy) }));

// ---------------------------
// STARFIELD + PLANETS + UI
// ---------------------------
const c = document.getElementById('stars');
const ctx = c.getContext('2d');
const p = document.getElementById('planets');
const px = p.getContext('2d');
const radar = document.getElementById('radar');
const glitch = document.getElementById('glitchEffect');
const modalWrap = document.getElementById('modalWrap');
const closeModalBtn = document.getElementById('closeModal');
const holoTitle = document.getElementById('holoTitle');
const holoContent = document.getElementById('holoContent');

let w,h,stars=[],planets=[],t=0,zoom=1,drag=false,ox=0,oy=0,cx=0,cy=0,flyAngle=0;
let flyMode=true, audioEnabled=true, constellations=true, radarOn=true;

function resize(){ w=innerWidth; h=innerHeight; c.width=p.width=w; c.height=p.height=h;
  stars = Array.from({length:500},()=>({x:Math.random()*w,y:Math.random()*h,z:Math.random()*w}));
  // planet orbits ‚Äî one per cycle
  planets = cycles.map((cycle,i)=>({ name:cycle, r:30+10*i, orbit:160+95*i, angle:Math.random()*Math.PI*2, clr:`hsl(${120+10*i},100%,60%)`, moons: [] }));
  // attach moons = number of books per cycle
  planets.forEach(pl=>{
    const books = BOOKS.filter(b=>b.cycle===pl.name);
    pl.moons = books.map((b,idx)=>({ book:b, angle:Math.random()*Math.PI*2, dist: pl.r*1.6 + 14 + idx*6, size: 2 + (idx%3), clr: pl.clr }));
  });
}
addEventListener('resize', resize); resize();

addEventListener('wheel', e=>{ zoom=Math.max(0.5, Math.min(3, zoom + e.deltaY*-0.001)); });
p.addEventListener('mousedown', e=>{ drag=true; ox=e.clientX; oy=e.clientY; });
addEventListener('mouseup', ()=> drag=false);
addEventListener('mousemove', e=>{ if(drag){ cx+=(e.clientX-ox)/zoom; cy+=(e.clientY-oy)/zoom; ox=e.clientX; oy=e.clientY; }});

function drawStars(){ ctx.fillStyle='rgba(0,0,0,0.3)'; ctx.fillRect(0,0,w,h);
  for(const s of stars){ s.z-=2; if(s.z<=0) s.z=w; const k=128/s.z*zoom; const x=w/2+(s.x-w/2)*k; const y=h/2+(s.y-h/2)*k; if(x<0||x>=w||y<0||y>=h) continue; const size=(1-s.z/w)*2; ctx.fillStyle='#00ff7f'; ctx.fillRect(x,y,size,size); }
  requestAnimationFrame(drawStars);
}
drawStars();

function drawPlanets(){ px.clearRect(0,0,w,h); t+=0.01; if(flyMode){ flyAngle+=0.003; cx=Math.cos(flyAngle)*200; cy=Math.sin(flyAngle)*200; }
  if(constellations){ px.beginPath(); px.strokeStyle='rgba(0,255,128,0.2)'; for(let i=0;i<planets.length-1;i++){ px.moveTo(w/2+cx+Math.cos(t+planets[i].angle)*planets[i].orbit*zoom, h/2+cy+Math.sin(t+planets[i].angle)*planets[i].orbit*zoom); px.lineTo(w/2+cx+Math.cos(t+planets[i+1].angle)*planets[i+1].orbit*zoom, h/2+cy+Math.sin(t+planets[i+1].angle)*planets[i+1].orbit*zoom); } px.stroke(); }
  for(const planet of planets){ const x=w/2+cx+Math.cos(t+planet.angle)*planet.orbit*zoom; const y=h/2+cy+Math.sin(t+planet.angle)*planet.orbit*zoom;
    px.beginPath(); px.arc(x,y,planet.r*zoom,0,Math.PI*2); px.strokeStyle=planet.clr; px.shadowBlur=15; px.shadowColor=planet.clr; px.stroke(); px.fillStyle=planet.clr; px.fillText(planet.name, x+planet.r*zoom+6, y);
    // moons = books
    for(const m of planet.moons){ const mx=x+Math.cos(t+m.angle)*m.dist*zoom; const my=y+Math.sin(t+m.angle)*m.dist*zoom; px.beginPath(); px.arc(mx,my,m.size,0,Math.PI*2); px.fillStyle=m.clr; px.fill(); m.x=mx; m.y=my; }
    planet.x=x; planet.y=y;
  }
  if(radarOn){ const rctx=radar.getContext('2d'); rctx.clearRect(0,0,150,150); rctx.strokeStyle='#00ff7f'; rctx.beginPath(); rctx.arc(75,75,70,0,Math.PI*2); rctx.stroke(); rctx.beginPath(); rctx.moveTo(75,75); rctx.lineTo(75+70*Math.cos(t),75+70*Math.sin(t)); rctx.stroke(); }
  requestAnimationFrame(drawPlanets);
}
drawPlanets();

// Click planets to open modal with that cycle
p.addEventListener('click', e=>{
  const rect=p.getBoundingClientRect(); const mx=e.clientX-rect.left; const my=e.clientY-rect.top;
  for(const planet of planets){ const dx=mx-planet.x, dy=my-planet.y; if(Math.sqrt(dx*dx+dy*dy) < planet.r*zoom){ openCycleModal(planet.name); return; } }
  // also allow clicking moons to open single-book focused modal (scroll to it)
  for(const planet of planets){ for(const m of planet.moons){ const dx=mx-m.x, dy=my-m.y; if(Math.sqrt(dx*dx+dy*dy) < (m.size+2)){ openCycleModal(planet.name, m.book.n); return; } } }
});

// ---------------------------
// MODAL RENDERING
// ---------------------------
function openCycleModal(cycleName, focusBookNum=null){
  holoTitle.textContent = cycleName + ' ‚Äî Abstracts';
  holoContent.innerHTML = '';
  const list = BOOKS.filter(b=>b.cycle===cycleName);
  // banner
  const banner = document.createElement('div');
  banner.className='cycle-banner';
  banner.textContent = cycleName + `  ‚ñ∏  ${list.length} titles`;
  holoContent.appendChild(banner);
  // cards
  for(const b of list){
    const card = document.createElement('div');
    card.className='book-card';
    card.id = 'book-'+b.n;
    card.innerHTML = `<div class="book-title">${b.n}. ${b.title}</div><div class="book-abstract">${b.abstract}</div>`;
    holoContent.appendChild(card);
  }
  modalWrap.style.display='block';
  // optional scroll to a highlighted book
  if(focusBookNum){ setTimeout(()=>{ const el=document.getElementById('book-'+focusBookNum); if(el){ el.scrollIntoView({behavior:'smooth',block:'center'}); el.style.boxShadow='0 0 22px #00ff7f'; setTimeout(()=>el.style.boxShadow='', 1200);} }, 50); }
}

document.getElementById('displayAll').addEventListener('click', ()=>{
  holoTitle.textContent = 'Zero Day Exploits ‚Äî All Abstracts';
  holoContent.innerHTML = '';
  for(const group of BOOKS_BY_CYCLE){
    const banner = document.createElement('div');
    banner.className='cycle-banner';
    banner.textContent = group.cycle + `  ‚ñ∏  ${group.books.length} titles`;
    holoContent.appendChild(banner);
    for(const b of group.books){
      const card = document.createElement('div');
      card.className='book-card';
      card.innerHTML = `<div class="book-title">${b.n}. ${b.title}</div><div class="book-abstract">${b.abstract}</div>`;
      holoContent.appendChild(card);
    }
  }
  modalWrap.style.display='block';
});

closeModalBtn.addEventListener('click', ()=>{ modalWrap.style.display='none'; });

// ---------------------------
// TOGGLES & GLITCH/AUDIO
// ---------------------------
let audioCtx = new (window.AudioContext||window.webkitAudioContext)();
let o = audioCtx.createOscillator();
let g = audioCtx.createGain();
let filter = audioCtx.createBiquadFilter();
o.connect(filter); filter.connect(g); g.connect(audioCtx.destination);
o.type='sawtooth'; o.frequency.value=80; filter.type='lowpass'; filter.frequency.value=500; g.gain.value=0.03; o.start();

function playGlitchSound(intensity=0.5){ if(!audioEnabled) return; let buffer=audioCtx.createBuffer(1, audioCtx.sampleRate*0.1, audioCtx.sampleRate); let data=buffer.getChannelData(0); for(let i=0;i<data.length;i++){ data[i]=(Math.random()*2-1)*(1-intensity); } let crackle=audioCtx.createBufferSource(); crackle.buffer=buffer; let gainNode=audioCtx.createGain(); gainNode.gain.value=0.08+intensity*0.25; crackle.connect(gainNode).connect(audioCtx.destination); crackle.start(); }

setInterval(()=>{ if(!audioEnabled) return; const freq=80+Math.sin(t)*160; o.frequency.value=freq; filter.frequency.value=500+Math.sin(t*2)*200; document.body.style.background=`radial-gradient(circle at 50% 50%, hsl(${freq},100%,5%), #000)`; }, 2000);

document.getElementById('toggleConstellations').addEventListener('change',e=>{ constellations=e.target.checked; });
document.getElementById('toggleAudio').addEventListener('change',e=>{ audioEnabled=e.target.checked; g.gain.value = audioEnabled ? 0.03 : 0; });
document.getElementById('toggleFly').addEventListener('change',e=>{ flyMode=e.target.checked; });
document.getElementById('toggleRadar').addEventListener('change',e=>{ radarOn=e.target.checked; radar.style.display=radarOn?'block':'none'; });

const keys = 'abcdefghijklmnopqrstuvwxyz0123456789'.split('');
addEventListener('keydown', e=>{ if(!keys.includes(e.key.toLowerCase())) return; triggerGlitch(Math.random()*0.5+0.3); playGlitchSound(); });
let touchActive=false;
addEventListener('touchstart', ()=>{ touchActive=true; let level=0; const iv=setInterval(()=>{ if(!touchActive){ clearInterval(iv); glitch.style.opacity=0; return;} level=Math.min(1, level+0.05); triggerGlitch(level); playGlitchSound(level); }, 50); });
addEventListener('touchend', ()=>{ touchActive=false; });

function triggerGlitch(intensity){ glitch.style.opacity=intensity; glitch.style.filter=`blur(${intensity*8}px) contrast(${100+intensity*400}%)`; setTimeout(()=>{ glitch.style.opacity=0; }, 300); }
</script>
</body>
</html>
